!function(){"use strict";var e={243:function(e,t,r){e.exports=r.p+"d3edfb3fe0284e46cb86.jpg"},769:function(e,t,r){e.exports=r.p+"05f1a4a8dccb609a7ff3.jpg"},199:function(e,t,r){e.exports=r.p+"4317d98e0be2323014f4.jpg"},408:function(e,t,r){e.exports=r.p+"c699805af844af80a2db.jpg"},462:function(e,t,r){e.exports=r.p+"0bbb8e918e3becd29120.jpg"},329:function(e,t,r){e.exports=r.p+"205114d203f083e3e22b.jpg"}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,r),o.exports}r.p="",function(){class e{constructor(e,t){this._config=e,this._formElement=t}enableValidation(){this.setEventListeners()}setEventListeners(){this._inputs=this._formElement.querySelectorAll(this._config.inputSelector),this._submitBtn=this._formElement.querySelector(this._config.submitButtonSelector),this._inputs.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e,this._formElement),this._updateSubmitButton()}))}))}_updateSubmitButton(){const e=this._checkFieldsValidity(this._inputs);this._setSubmitButtonState(e)}_setSubmitButtonState(e){this._submitBtn.disabled=e}_checkFieldsValidity(){return Array.from(this._inputs).some((e=>!e.validity.valid))}_checkInputValidity(e){e.validity.valid?(this._removeErrorStyles(e),this._hideErrorMessage(e)):(this._addErrorStyles(e),this._showErrorMessage(e))}_removeErrorStyles(e){e.classList.remove(this._config.inputHasError)}_hideErrorMessage(e){this._formElement.querySelector(".".concat(e.id,"-error")).classList.remove(this._config.errorTextVisible)}_addErrorStyles(e){e.classList.add(this._config.inputHasError)}_showErrorMessage(e){const t=this._formElement.querySelector(".".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(this._config.errorTextVisible)}resetValidation(){this._updateSubmitButton(),this._inputs.forEach((e=>{this._hideErrorMessage(e),this._removeErrorStyles(e)}))}}class t{constructor(e,t){let{data:r,handleCardClick:s,handleTrashClick:n}=e;this._template=document.querySelector("#".concat(t)),this._data=r,this._handleCardClick=s,this._handleTrashClick=n}createCard(){this._card=this._template.content.cloneNode(!0).querySelector(".element");const e=this._card.querySelector(".element__title"),t=this._card.querySelector(".element__image");return t.src=this._data.url,t.alt=this._data.title,e.textContent=this._data.title,this._setEventListeners(),this._card}_updateLikeCount(){this._card.querySelector(".like-button__counter").textContent=this._liked.length}_setEventListeners(){this._card.querySelector(".element__image").addEventListener("click",(e=>{this._handleCardClick(e)})),this._card.querySelector("#delete-card-button").addEventListener("click",(()=>{this._handleTrashClick()})),this._card.querySelector(".like-button").addEventListener("click",(()=>{this._toggleLike()}))}_toggleLike(){this._card.querySelector(".like-button").classList.add("like-button_active"),this._updateLikeCount()}}class s{constructor(e){this._popupElement=document.querySelector("#".concat(e)),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("popup-form_open"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup-form_open"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.addEventListener("click",(e=>{(e.target===this._popupElement||e.target.classList.contains("close-button"))&&this.close()}))}}class n extends s{constructor(e){let{popupSelector:t,handleFormSubmit:r}=e;super(t),this._form=this._popupElement.querySelector(".popup-form__input-container"),this._formInputs=this._popupElement.querySelectorAll(".popup-form__input"),this._handleFormSubmit=r}_getInputValues(){return this._formValues={},this._formInputs.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()}))}resetForm(){this._form.reset()}}const o=[{title:"Palm Springs Aerial Tramway",url:r(199)},{title:"Cedar Point, OH",url:r(769)},{title:"N.A. Pow Wows",url:r(462)},{title:"Colonial Williamsburg",url:r(243)},{title:"Old San Juan, Puerto Rico",url:r(408)},{title:"Disney World",url:r(329)}],i={formSelector:".popup-form__input-container",inputSelector:".popup-form__input",submitButtonSelector:".submit-button",inactiveButtonClass:"popup-form__submit-button_type_disabled",errorTextSelector:".popup-form__error-text",inputHasError:"popup-form__input_has_error",errorTextVisible:"popup-form__error-text_visible"},a=document.querySelector("#edit-button"),l=document.querySelector(".add-button"),c=document.querySelector("#profile-pic-button"),d=document.querySelector("#name"),u=document.querySelector("#description"),p=document.querySelector("#profile-pic"),h=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}_handleServerResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}getUserInfo(){fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then(this._handleServerResponse)}setUserInfo(e){let{name:t,description:r}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,description:r})}).then(this._handleServerResponse)}updateProfilePicture(e){let{avatar:t}=e;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then(this._handleServerResponse)}getInitialCardList(e){let{title:t,url:r}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"GET",body:JSON.stringify({title:t,url:r})}).then(this._handleServerResponse)}addCard(e){let{title:t,url:r}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({title:t,url:r})}).then(this._handleServerResponse)}removeCard(e){let{_id:t}=e;return fetch("".concat(this._baseUrl,"/cards/cardId"),{method:"DELETE",headers:this._headers,body:JSON.stringify({_id:t}).then(this._handleServerResponse)})}toggleLikeCardStatus(e,t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"PUT":"DELETE",headers:this._headers}).then(this._handleServerResponse)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"9b991f86-368d-4ef3-963c-b91580821c46"}}),m=new class extends s{open(e){let{url:t,title:r}=e;this._popupElement.querySelector(".popup-form__caption").textContent=r,this._imgElement=this._popupElement.querySelector(".popup-form__image"),this._imgElement.src=t,this._imgElement.alt=r,super.open()}}("image-popup"),_=e=>new t({data:e,handleCardClick:()=>{m.open(e)},handleTrashClick:()=>{v.open()}},"card-template").createCard(),f=new class{constructor(e,t){let{items:r,renderer:s}=e;this._items=r,this._renderer=s,this._container=document.querySelector(".".concat(t))}renderItem(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:o,renderer:e=>{h.getInitialCardList({title:e.title,url:e.url}).then((e=>{f.addItem(_(e))})).catch((e=>console.log("An error occurred adding the initial cards: ".concat(e))))}},"elements"),S=new class{constructor(e){let{nameSelector:t,descriptionSelector:r}=e;this._nameElement=document.querySelector(".".concat(t)),this._descriptionElement=document.querySelector(".".concat(r))}getUserInfo(){return{name:this._nameElement.textContent,description:this._descriptionElement.textContent}}setUserInfo(e){let{name:t,description:r}=e;this._nameElement.textContent=t,this._descriptionElement.textContent=r}}({nameSelector:"profile__name",descriptionSelector:"profile__description"}),E=new n({popupSelector:"edit-popup-form",handleFormSubmit:e=>{h.setUserInfo({name:e.name,description:e.description}).then((e=>{S.setUserInfo({name:e.name,description:e.description}),E.close()})).catch((e=>console.log("An error occurred updating user information: ".concat(e)))).finally((()=>{}))}}),b=new n({popupSelector:"create-popup-form",handleFormSubmit:e=>{h.addCard(e).then((e=>{f.addItem(_(e)),b.resetForm()})).catch((e=>console.log("An error had occurred while adding your card :( : ".concat(e)))).finally((()=>{}))}}),v=new class extends s{constructor(e){let{popupSelector:t}=e;super(t)}setEventListeners(){super.setEventListeners(),document.querySelector("#confirmation-button").addEventListener("click",(()=>{this.deleteCard(),this.close()}))}deleteCard(){document.querySelector(".element").remove()}}({popupSelector:"delete-confirmation-popup"}),y=new n({popupSelector:"profile-picture-popup",handleFormSubmit:()=>{document.querySelector(".profile__image").src=p.value,y.resetForm()}}),g=new e(i,document.querySelector("#edit-popup-form"));g.enableValidation();const L=new e(i,document.querySelector("#create-popup-form"));L.enableValidation();const C=new e(i,document.querySelector("#profile-picture-popup"));C.enableValidation(),a.addEventListener("click",(()=>{E.open();const{name:e,description:t}=S.getUserInfo();d.value=e,u.value=t,g.resetValidation()})),l.addEventListener("click",(()=>{b.resetForm(),L.resetValidation(),b.open()})),c.addEventListener("click",(()=>{C.resetValidation(),y.open()})),f.renderItem(o),m.setEventListeners(),E.setEventListeners(),b.setEventListeners(),v.setEventListeners(),y.setEventListeners()}()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQW9COUgsa0JBQ3BCMEgsRUFBb0IzRixVQUd0QjRCLEVBQXFCckYsaUJBQWlCLFNBQVMsS0FDN0N5SixFQUFvQi9ILGtCQUNwQjRILEVBQW9CN0YsVUFJdEJrRSxFQUFTTyxXQUFXckQsR0FDcEIyQyxFQUFXakksb0JBQ1gwSixFQUFxQjFKLG9CQUNyQjZKLEVBQW9CN0osb0JBQ3BCbUksRUFBdUJuSSxvQkFDdkIrSixFQUFvQi9KLG9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80L3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxzL0NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2UvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhEZWxldGVDb25maXJtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiOyIsIi8vIEZvcm0gVmFsaWRhdGlvbiBjbGFzcyBjb2RlXG5cbi8vIFwiY29uZmlnXCIgPSBhcnJheSBvZiBzZWxlY3RvcnMgJiBcImZvcm1FbGVtZW50XCIgPSBmb3JtXG5leHBvcnQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZywgZm9ybUVsZW1lbnQpIHtcbiAgICB0aGlzLl9jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgLy8gYWRkIGV2ZW50IGxpc3RlbmVyIGZ1bmN0aW9uOiBpdCB3aWxsIHVzZSBwYXJhbWV0ZXJzIGZvcm0gYW5kIHNldHRpbmdzLlxuICAvLyBzZWxlY3QgYWxsIG9mIHRoZSBpbnB1dHNcbiAgLy8vIHdhbnQgdG8gc2VsZWN0IHN1Ym1pdCBidXR0b24gaW4gdGhzIGZ4IHRvb1xuICAvLy8gYWRkIGEgcGFydCB0aGF0IGhhcyBhIGNvbmRpdGlvbiB3aGVyZSB0aGVyZSBpcyBhbiBlcnJvciBhbmQgd2hhdCB0byBkbyB0aGVuXG4gIC8vLyBhZGQgYnV0dG9uIGRpc2FibGUgdG9nZ2xlXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2lucHV0cyA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICB0aGlzLl9jb25maWcuaW5wdXRTZWxlY3RvclxuICAgICk7XG4gICAgdGhpcy5fc3VibWl0QnRuID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX2NvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgICk7XG4gICAgLy9jaGVja3MgaW4gcHV0IHZhbGlkaXR5ICYgY2hlY2sgYWxsIGlucHV0cyBmb3IgdmFsaWRpdHlcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZXZ0KSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dCwgdGhpcy5fZm9ybUVsZW1lbnQpO1xuICAgICAgICB0aGlzLl91cGRhdGVTdWJtaXRCdXR0b24oKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgX3VwZGF0ZVN1Ym1pdEJ1dHRvbigpIHtcbiAgICBjb25zdCBoYXNFcnJvcnMgPSB0aGlzLl9jaGVja0ZpZWxkc1ZhbGlkaXR5KHRoaXMuX2lucHV0cyk7XG4gICAgdGhpcy5fc2V0U3VibWl0QnV0dG9uU3RhdGUoaGFzRXJyb3JzKTtcbiAgfVxuXG4gIC8vIHRvZ2dsZXMgdGhlIGJ1dHRvbiBiZXR3ZWVuIGRpc2FibGVkIGFuZCBlbmFibGVkXG4gIF9zZXRTdWJtaXRCdXR0b25TdGF0ZShoYXNFcnJvcnMpIHtcbiAgICB0aGlzLl9zdWJtaXRCdG4uZGlzYWJsZWQgPSBoYXNFcnJvcnM7XG4gIH1cblxuICAvLyB0dXJuIGlucHV0cyBpbnRvIGFuIGFycmF5LCB0YWtlIHNvbWUgaW5wdXQ7IHJldHVybiBzb2x1dGlvbiBpZiBpbnB1dCBpcyBpbnZhbGlkXG4gIF9jaGVja0ZpZWxkc1ZhbGlkaXR5KCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuX2lucHV0cykuc29tZSgoaW5wdXQpID0+ICFpbnB1dC52YWxpZGl0eS52YWxpZCk7XG4gIH1cblxuICAvLyByZW1vdmVzL2hpZGVzIGVycm9ycyBpZiBpbnB1dHMgYXJlIHZhbGlkXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXQpIHtcbiAgICBpZiAoaW5wdXQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3JlbW92ZUVycm9yU3R5bGVzKGlucHV0KTtcbiAgICAgIHRoaXMuX2hpZGVFcnJvck1lc3NhZ2UoaW5wdXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9hZGRFcnJvclN0eWxlcyhpbnB1dCk7XG4gICAgICB0aGlzLl9zaG93RXJyb3JNZXNzYWdlKGlucHV0KTtcbiAgICB9XG4gIH1cblxuICBfcmVtb3ZlRXJyb3JTdHlsZXMoaW5wdXQpIHtcbiAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2NvbmZpZy5pbnB1dEhhc0Vycm9yKTtcbiAgfVxuXG4gIF9oaWRlRXJyb3JNZXNzYWdlKGlucHV0KSB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgLiR7aW5wdXQuaWR9LWVycm9yYFxuICAgICk7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2NvbmZpZy5lcnJvclRleHRWaXNpYmxlKTtcbiAgfVxuXG4gIF9hZGRFcnJvclN0eWxlcyhpbnB1dCkge1xuICAgIGlucHV0LmNsYXNzTGlzdC5hZGQodGhpcy5fY29uZmlnLmlucHV0SGFzRXJyb3IpO1xuICB9XG5cbiAgX3Nob3dFcnJvck1lc3NhZ2UoaW5wdXQpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuJHtpbnB1dC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gaW5wdXQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2NvbmZpZy5lcnJvclRleHRWaXNpYmxlKTtcbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl91cGRhdGVTdWJtaXRCdXR0b24oKTtcblxuICAgIHRoaXMuX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUVycm9yTWVzc2FnZShpbnB1dCk7XG4gICAgICB0aGlzLl9yZW1vdmVFcnJvclN0eWxlcyhpbnB1dCk7XG4gICAgfSk7XG4gIH1cbn1cblxuLy8gdG8gY2hlY2sgdG8gc2VlIGlmIHNvbWV0aGluZyBpcyBiZWluZyBncmFiYmVkIGNvcnJlY3RseVxuLy8vIHZpYSBkZXYgdG9vbHM6IGkuZS4gdHlwZSBcImlucHV0LmlkXCIgdG8gc2VlIHdoaWNoIGlucHV0IGZ1bmN0aW9uIGlzIGdyYWJiaW5nXG4iLCJleHBvcnQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKHsgZGF0YSwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVUcmFzaENsaWNrfSwgdGVtcGxhdGVTZWxlY3Rvcikge1xuICAgIHRoaXMuX3RlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7dGVtcGxhdGVTZWxlY3Rvcn1gKTtcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlVHJhc2hDbGljayA9IGhhbmRsZVRyYXNoQ2xpY2s7XG4gIH1cblxuICBjcmVhdGVDYXJkKCkge1xuICAgIHRoaXMuX2NhcmQgPSB0aGlzLl90ZW1wbGF0ZS5jb250ZW50LmNsb25lTm9kZSh0cnVlKS5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRcIik7XG4gICBcbiAgICBjb25zdCB0aXRsZUVsZW1lbnQgPSB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fdGl0bGVcIik7XG4gICAgY29uc3QgaW1nRWxlbWVudCA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19pbWFnZVwiKTtcblxuICAgIGltZ0VsZW1lbnQuc3JjID0gdGhpcy5fZGF0YS51cmw7XG4gICAgaW1nRWxlbWVudC5hbHQgPSB0aGlzLl9kYXRhLnRpdGxlO1xuICAgIHRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuX2RhdGEudGl0bGU7XG5cbiAgICAvLyBjbGljayBvbiBpbWcgdG8gb3BlbiBpbWcgbW9kYWwgKGNhdXNlcyBpbml0aWFsIGNhcmRzIG5vdCB0byBzaG93IHVwKVxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICByZXR1cm4gdGhpcy5fY2FyZDtcbiAgfVxuXG4gIF91cGRhdGVMaWtlQ291bnQoKSB7XG4gICAgdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmxpa2UtYnV0dG9uX19jb3VudGVyXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZWQubGVuZ3RoO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkgeyAgXG4gICAgY29uc3QgaW1nRWxlbWVudCA9IHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19pbWFnZVwiKTtcblxuICAgIGltZ0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChkYXRhKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soZGF0YSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWNhcmQtYnV0dG9uXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVUcmFzaENsaWNrKCk7XG4gICAgfSk7XG5cbiAgICAvLyBsaWtlL3VubGlrZSBidXR0b25cbiAgICB0aGlzLl9jYXJkLnF1ZXJ5U2VsZWN0b3IoXCIubGlrZS1idXR0b25cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX3RvZ2dsZUxpa2UoKTtcbiAgICB9KTtcbiAgfVxuXG4gIF90b2dnbGVMaWtlKCkge1xuICAgIHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5saWtlLWJ1dHRvblwiKS5jbGFzc0xpc3QuYWRkKFwibGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIHRoaXMuX3VwZGF0ZUxpa2VDb3VudCgpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtwb3B1cFNlbGVjdG9yfWApO1xuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cC1mb3JtX29wZW5cIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cC1mb3JtX29wZW5cIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgX2hhbmRsZUVzY0Nsb3NlKGUpIHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAvLyBpZiBjbGljayBvdXRzaWRlIHBvcHVwIG9yIGNsaWNrIG9uIHggYnV0dG9uLCBjbG9zZSBwb3B1cC5cbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMuX3BvcHVwRWxlbWVudCB8fCBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjbG9zZS1idXR0b25cIikpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHsgcG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCB9KSB7XG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwLWZvcm1fX2lucHV0LWNvbnRhaW5lclwiKTtcbiAgICB0aGlzLl9mb3JtSW5wdXRzID1cbiAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwLWZvcm1fX2lucHV0XCIpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIHRoaXMuX2Zvcm1WYWx1ZXMgPSB7fTtcblxuICAgIHRoaXMuX2Zvcm1JbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMuX2Zvcm1WYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5fZm9ybVZhbHVlcztcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cblxuICByZXNldEZvcm0oKSB7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpO1xuICB9XG59XG4iLCIvL2xvY2FsIGltYWdlc1xuY29uc3QgVHJhbXdheSA9IHJlcXVpcmUoXCIuLi9pbWFnZXMvUGFsbS1TcHJpbmdzLUFlcmlhbC1UcmFtd2F5LWNvbG9yZml4LmpwZ1wiKTtcbmNvbnN0IENlZGFyUHQgPSByZXF1aXJlKFwiLi4vaW1hZ2VzL0NvcmtzY3Jld18oQ2VkYXJfUG9pbnQpXzAxLmpwZ1wiKTtcbmNvbnN0IFBvd1dvdyA9IHJlcXVpcmUoXCIuLi9pbWFnZXMvamVzcy1saW5kbmVyLXhlZ3lEbjEtU29ZLXVuc3BsYXNoLWNvbG9yZml4LmpwZ1wiKTtcbmNvbnN0IENvbFdpbGxpYW1zYnVyZyA9IHJlcXVpcmUoXCIuLi9pbWFnZXMvQ29sb25pYWwtV2lsbGlhbXNidXJnLVZpcmdpbmlhc2l6ZWZpeC0yLmpwZ1wiKTtcbmNvbnN0IFB1ZXJ0b1JpY28gPSByZXF1aXJlKFwiLi4vaW1hZ2VzL2plbm5pZmVyLWNoZW4teVhKaUMyVWpJQm8tdW5zcGxhc2gtY29sb3JmaXguanBnXCIpO1xuY29uc3QgRGlzbmV5V29ybGQgPSByZXF1aXJlKFwiLi4vaW1hZ2VzL3NhbmRyby1nb256YWxlei1kQkVKRzZodjIyNC11bnNwbGFzaC5qcGdcIik7XG5cbi8vbG9vcCBmb3IgaW5pdGlhbCBjYXJkc1xuZXhwb3J0IGNvbnN0IGluaXRpYWxDYXJkcyA9IFtcbiAge1xuICAgIHRpdGxlOiBcIlBhbG0gU3ByaW5ncyBBZXJpYWwgVHJhbXdheVwiLFxuICAgIHVybDogVHJhbXdheSxcbiAgfSxcbiAge1xuICAgIHRpdGxlOiBcIkNlZGFyIFBvaW50LCBPSFwiLFxuICAgIHVybDogQ2VkYXJQdCxcbiAgfSxcbiAge1xuICAgIHRpdGxlOiBcIk4uQS4gUG93IFdvd3NcIixcbiAgICB1cmw6IFBvd1dvdyxcbiAgfSxcbiAge1xuICAgIHRpdGxlOiBcIkNvbG9uaWFsIFdpbGxpYW1zYnVyZ1wiLFxuICAgIHVybDogQ29sV2lsbGlhbXNidXJnLFxuICB9LFxuICB7XG4gICAgdGl0bGU6IFwiT2xkIFNhbiBKdWFuLCBQdWVydG8gUmljb1wiLFxuICAgIHVybDogUHVlcnRvUmljbyxcbiAgfSxcbiAge1xuICAgIHRpdGxlOiBcIkRpc25leSBXb3JsZFwiLFxuICAgIHVybDogRGlzbmV5V29ybGQsXG4gIH0sXG5dO1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cC1mb3JtX19pbnB1dC1jb250YWluZXJcIixcbiAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXAtZm9ybV9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnN1Ym1pdC1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cC1mb3JtX19zdWJtaXQtYnV0dG9uX3R5cGVfZGlzYWJsZWRcIixcbiAgZXJyb3JUZXh0U2VsZWN0b3I6IFwiLnBvcHVwLWZvcm1fX2Vycm9yLXRleHRcIixcbiAgaW5wdXRIYXNFcnJvcjogXCJwb3B1cC1mb3JtX19pbnB1dF9oYXNfZXJyb3JcIixcbiAgZXJyb3JUZXh0VmlzaWJsZTogXCJwb3B1cC1mb3JtX19lcnJvci10ZXh0X3Zpc2libGVcIixcbn07XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuXG5pbXBvcnQgeyBGb3JtVmFsaWRhdG9yIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IHsgQ2FyZCB9IGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoRGVsZXRlQ29uZmlybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhEZWxldGVDb25maXJtLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuXG5pbXBvcnQge1xuICBpbml0aWFsQ2FyZHMsXG4gIHZhbGlkYXRpb25Db25maWcsXG59IGZyb20gXCIuLi91dGlscy9Db25zdGFudHMuanNcIjtcblxuLy9idXR0b25zXG5jb25zdCBlZGl0UHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1idXR0b25cIik7XG5jb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hZGQtYnV0dG9uXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVQaWNCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtcGljLWJ1dHRvblwiKTtcblxuXG5cbi8vaW5wdXRzXG5jb25zdCBpbnB1dE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25hbWVcIik7XG5jb25zdCBpbnB1dEpvYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVzY3JpcHRpb25cIik7XG5jb25zdCBpbnB1dFBpY3R1cmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtcGljXCIpO1xuXG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiOWI5OTFmODYtMzY4ZC00ZWYzLTk2M2MtYjkxNTgwODIxYzQ2XCIsXG4gIH1cbn0pXG5cblxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcImltYWdlLXBvcHVwXCIpO1xuXG5jb25zdCBjcmVhdGVDYXJkID0gKGRhdGEpID0+IHtcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxuICAgIHtcbiAgICAgIGRhdGEsXG4gICAgICBoYW5kbGVDYXJkQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgaW1hZ2VQb3B1cC5vcGVuKGRhdGEpXG4gICAgICB9LFxuICAgICAgaGFuZGxlVHJhc2hDbGljazogKCkgPT4ge1xuICAgICAgICBkZWxldGVDb25maXJtUG9wdXBGb3JtLm9wZW4oKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiY2FyZC10ZW1wbGF0ZVwiXG4gICk7XG4gIHJldHVybiBjYXJkLmNyZWF0ZUNhcmQoKTtcbn07XG5cbmNvbnN0IGNhcmRMaXN0ID0gbmV3IFNlY3Rpb24oXG4gIHtcbiAgICBpdGVtczogaW5pdGlhbENhcmRzLFxuICAgIHJlbmRlcmVyOiAoZGF0YSkgPT4ge1xuXG4gICAgICBhcGkgXG4gICAgICAgIC5nZXRJbml0aWFsQ2FyZExpc3Qoe1xuICAgICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLFxuICAgICAgICAgIHVybDogZGF0YS51cmwsXG4gICAgICAgIH0pXG5cbiAgICAgICAgLnRoZW4oKGNhcmREYXRhKSA9PiB7XG4gICAgICAgICAgY2FyZExpc3QuYWRkSXRlbShjcmVhdGVDYXJkKGNhcmREYXRhKSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiBcbiAgICAgICAgICBjb25zb2xlLmxvZyhgQW4gZXJyb3Igb2NjdXJyZWQgYWRkaW5nIHRoZSBpbml0aWFsIGNhcmRzOiAke2Vycn1gKSlcbiAgICB9LFxuICB9LFxuICBcImVsZW1lbnRzXCJcbik7XG5cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHtcbiAgbmFtZVNlbGVjdG9yOiBcInByb2ZpbGVfX25hbWVcIixcbiAgZGVzY3JpcHRpb25TZWxlY3RvcjogXCJwcm9maWxlX19kZXNjcmlwdGlvblwiLFxufSk7XG5cbmNvbnN0IGVkaXRQcm9maWxlUG9wdXBGb3JtID0gbmV3IFBvcHVwV2l0aEZvcm0oe1xuICBwb3B1cFNlbGVjdG9yOiBcImVkaXQtcG9wdXAtZm9ybVwiLFxuICBoYW5kbGVGb3JtU3VibWl0OiAoZGF0YSkgPT4ge1xuXG4gICAgYXBpXG4gICAgICAuc2V0VXNlckluZm8oe1xuICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgfSlcblxuICAgICAgLnRoZW4oKGluZm8pID0+IHtcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xuICAgICAgICAgIG5hbWU6IGluZm8ubmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogaW5mby5kZXNjcmlwdGlvbixcbiAgICAgICAgfSk7XG4gICAgICAgIGVkaXRQcm9maWxlUG9wdXBGb3JtLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IFxuICAgICAgICBjb25zb2xlLmxvZyhgQW4gZXJyb3Igb2NjdXJyZWQgdXBkYXRpbmcgdXNlciBpbmZvcm1hdGlvbjogJHtlcnJ9YCkpXG5cbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgLy9sb2FkaW5nXG4gICAgICB9KVxuICB9LFxufSk7XG5cbmNvbnN0IGNyZWF0ZUNhcmRQb3B1cEZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIHBvcHVwU2VsZWN0b3I6IFwiY3JlYXRlLXBvcHVwLWZvcm1cIixcbiAgaGFuZGxlRm9ybVN1Ym1pdDogKGRhdGEpID0+IHtcblxuICAgIGFwaVxuICAgICAgLmFkZENhcmQoZGF0YSlcbiAgICAgIC50aGVuKChjYXJkRGF0YSkgPT4ge1xuICAgICAgICBjYXJkTGlzdC5hZGRJdGVtKGNyZWF0ZUNhcmQoY2FyZERhdGEpKTtcbiAgICAgICAgY3JlYXRlQ2FyZFBvcHVwRm9ybS5yZXNldEZvcm0oKTtcbiAgICAgIH0pXG5cbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBcbiAgICAgICAgY29uc29sZS5sb2coYEFuIGVycm9yIGhhZCBvY2N1cnJlZCB3aGlsZSBhZGRpbmcgeW91ciBjYXJkIDooIDogJHtlcnJ9YClcbiAgICAgICAgKVxuXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIC8vbG9hZGluZ1xuICAgICAgfSlcbiAgfSxcbn0pO1xuXG5jb25zdCBkZWxldGVDb25maXJtUG9wdXBGb3JtID0gbmV3IFBvcHVwV2l0aERlbGV0ZUNvbmZpcm0oe1xuICBwb3B1cFNlbGVjdG9yOiBcImRlbGV0ZS1jb25maXJtYXRpb24tcG9wdXBcIlxufSk7XG5cbmNvbnN0IHByb2ZpbGVQaWNQb3B1cEZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIHBvcHVwU2VsZWN0b3I6IFwicHJvZmlsZS1waWN0dXJlLXBvcHVwXCIsXG4gIGhhbmRsZUZvcm1TdWJtaXQ6ICgpID0+IHtcbiAgICBjb25zdCBwaWN0dXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19pbWFnZVwiKTtcbiAgICBwaWN0dXJlLnNyYyA9IGlucHV0UGljdHVyZS52YWx1ZTtcbiAgICBwcm9maWxlUGljUG9wdXBGb3JtLnJlc2V0Rm9ybSgpO1xuICB9XG59KTtcblxuY29uc3QgZWRpdFByb2ZpbGVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcbiAgdmFsaWRhdGlvbkNvbmZpZyxcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXBvcHVwLWZvcm1cIilcbik7XG5lZGl0UHJvZmlsZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGNyZWF0ZUNhcmRWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcbiAgdmFsaWRhdGlvbkNvbmZpZyxcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjcmVhdGUtcG9wdXAtZm9ybVwiKVxuKTtcbmNyZWF0ZUNhcmRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBwcm9maWxlUGljVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXG4gIHZhbGlkYXRpb25Db25maWcsXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1waWN0dXJlLXBvcHVwXCIpXG4pO1xucHJvZmlsZVBpY1ZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmVkaXRQcm9maWxlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGVkaXRQcm9maWxlUG9wdXBGb3JtLm9wZW4oKTtcbiAgY29uc3Qge25hbWUsIGRlc2NyaXB0aW9ufSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIGlucHV0TmFtZS52YWx1ZSA9IG5hbWU7XG4gIGlucHV0Sm9iLnZhbHVlID0gZGVzY3JpcHRpb247XG4gIGVkaXRQcm9maWxlVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xufSk7XG5cbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY3JlYXRlQ2FyZFBvcHVwRm9ybS5yZXNldEZvcm0oKTtcbiAgY3JlYXRlQ2FyZFZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbiAgY3JlYXRlQ2FyZFBvcHVwRm9ybS5vcGVuKCk7XG59KTtcblxuZWRpdFByb2ZpbGVQaWNCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcHJvZmlsZVBpY1ZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbiAgcHJvZmlsZVBpY1BvcHVwRm9ybS5vcGVuKCk7XG59KVxuXG5cbmNhcmRMaXN0LnJlbmRlckl0ZW0oaW5pdGlhbENhcmRzKTtcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmVkaXRQcm9maWxlUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5jcmVhdGVDYXJkUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5kZWxldGVDb25maXJtUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5wcm9maWxlUGljUG9wdXBGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgICBjb25zdHJ1Y3Rvcih7YmFzZVVybCwgaGVhZGVyc30pIHtcbiAgICAgICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICAgIH1cblxuLy8gdXNlZCB0byBnZXQgdGhlIHNlcnZlciByZXNwb25zZVxuICAgIF9oYW5kbGVTZXJ2ZXJSZXNwb25zZShyZXMpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9XG4gICAgXG4vL3VzZWQgdG8gcmVxdWVzdCB1c2VyIGluZm9cbiAgICBnZXRVc2VySW5mbygpIHtcbiAgICAgICAgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLH0pXG4gICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcbiAgICB9XG5cbi8vdXNlZCB0byBpbnNlcnQgdXNlciBpbmZvXG4gICAgc2V0VXNlckluZm8oe25hbWUsIGRlc2NyaXB0aW9ufSkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvblxuICAgICAgICAgICAgfSksXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcbiAgICB9XG5cbiAvLyB1c2VkIHRvIGluc2VydCBwcm9maWxlIHBpYyAgIFxuICAgIHVwZGF0ZVByb2ZpbGVQaWN0dXJlKHthdmF0YXJ9KSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcbiAgICB9XG5cbiAgLy8gdXNlZCB0byBnZXQgaW5pdGlhbCBjYXJkcyBmcm9tIHNlcnZlciAgXG4gICAgZ2V0SW5pdGlhbENhcmRMaXN0KHt0aXRsZSwgdXJsfSkge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICAgICAgdXJsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4odGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UpXG4gICAgfVxuXG4vLyB1c2VkIHRvIGFkZCBjYXJkcyB0byBwYWdlXG4gICAgYWRkQ2FyZCh7dGl0bGUsIHVybH0pIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKVxuICAgIH1cblxuLy8gcmVtb3ZlcyBjYXJkc1xuICAgIHJlbW92ZUNhcmQoe19pZH0pIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2NhcmRJZGAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgX2lkLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBcbiAgICB0b2dnbGVMaWtlQ2FyZFN0YXR1cyhjYXJkSWQsIGxpa2UpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogbGlrZSA/IFwiUFVUXCIgOiBcIkRFTEVURVwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4odGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UpXG4gICAgfVxuXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgb3Blbih7IHVybCwgdGl0bGUgfSkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwLWZvcm1fX2NhcHRpb25cIikudGV4dENvbnRlbnQgPVxuICAgICAgdGl0bGU7XG4gICAgdGhpcy5faW1nRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwLWZvcm1fX2ltYWdlXCIpO1xuICAgIHRoaXMuX2ltZ0VsZW1lbnQuc3JjID0gdXJsO1xuICAgIHRoaXMuX2ltZ0VsZW1lbnQuYWx0ID0gdGl0bGU7XG5cbiAgICBzdXBlci5vcGVuKCk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtjb250YWluZXJTZWxlY3Rvcn1gKTtcbiAgfVxuICAvLyBsb29wcyB0aHJvdWdoIGVhY2ggb2YgdGhlIGl0ZW1zIHRoYXQgd2VyZSBjYWxsZWQgaW4gYW5kIGNhbGxzIHRoZSByZW5kZXJlciBvbiB0aGF0IGl0ZW1cbiAgcmVuZGVySXRlbSgpIHtcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHsgbmFtZVNlbGVjdG9yLCBkZXNjcmlwdGlvblNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9uYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke25hbWVTZWxlY3Rvcn1gKTtcbiAgICB0aGlzLl9kZXNjcmlwdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtkZXNjcmlwdGlvblNlbGVjdG9yfWApO1xuICB9XG4gIC8vcmV0dXJucyBhbiBvYmplY3Qgd2l0aCBpbmZvIGFib3V0IHRoZSB1c2VyXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLl9kZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgfTtcbiAgfVxuICAvL3Rha2VzIG5ldyB1c2VyIGRhdGEgYW5kIGFkZHMgaXQgb24gdGhlIHBhZ2VcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBkZXNjcmlwdGlvbiB9KSB7XG4gICAgdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHRoaXMuX2Rlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IGRlc2NyaXB0aW9uO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRGVsZXRlQ29uZmlybSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcih7cG9wdXBTZWxlY3Rvcn0pIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgICAgICAgY29uc3QgZGVsZXRlQ29uZmlybUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY29uZmlybWF0aW9uLWJ1dHRvblwiKTtcblxuICAgICAgICBkZWxldGVDb25maXJtQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRlbGV0ZUNhcmQoKTtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZGVsZXRlQ2FyZCgpIHtcbiAgICAgICAgY29uc3QgY2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudFwiKTtcbiAgICAgICAgY2FyZC5yZW1vdmUoKTtcbiAgICB9XG59XG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJwIiwiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiZm9ybUVsZW1lbnQiLCJ0aGlzIiwiX2NvbmZpZyIsIl9mb3JtRWxlbWVudCIsImVuYWJsZVZhbGlkYXRpb24iLCJzZXRFdmVudExpc3RlbmVycyIsIl9pbnB1dHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdG4iLCJxdWVyeVNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJmb3JFYWNoIiwiaW5wdXQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsIl91cGRhdGVTdWJtaXRCdXR0b24iLCJoYXNFcnJvcnMiLCJfY2hlY2tGaWVsZHNWYWxpZGl0eSIsIl9zZXRTdWJtaXRCdXR0b25TdGF0ZSIsImRpc2FibGVkIiwiQXJyYXkiLCJmcm9tIiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJfcmVtb3ZlRXJyb3JTdHlsZXMiLCJfaGlkZUVycm9yTWVzc2FnZSIsIl9hZGRFcnJvclN0eWxlcyIsIl9zaG93RXJyb3JNZXNzYWdlIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiaW5wdXRIYXNFcnJvciIsImlkIiwiZXJyb3JUZXh0VmlzaWJsZSIsImFkZCIsImVycm9yTWVzc2FnZUVsZW1lbnQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwicmVzZXRWYWxpZGF0aW9uIiwiQ2FyZCIsInRlbXBsYXRlU2VsZWN0b3IiLCJkYXRhIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlVHJhc2hDbGljayIsIl90ZW1wbGF0ZSIsImRvY3VtZW50IiwiX2RhdGEiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX2hhbmRsZVRyYXNoQ2xpY2siLCJjcmVhdGVDYXJkIiwiX2NhcmQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwidGl0bGVFbGVtZW50IiwiaW1nRWxlbWVudCIsInNyYyIsInVybCIsImFsdCIsInRpdGxlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX3VwZGF0ZUxpa2VDb3VudCIsIl9saWtlZCIsImxlbmd0aCIsIl90b2dnbGVMaWtlIiwiUG9wdXAiLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwRWxlbWVudCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJvcGVuIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZSIsImtleSIsInRhcmdldCIsImNvbnRhaW5zIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9mb3JtIiwiX2Zvcm1JbnB1dHMiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9nZXRJbnB1dFZhbHVlcyIsIl9mb3JtVmFsdWVzIiwibmFtZSIsInZhbHVlIiwicHJldmVudERlZmF1bHQiLCJyZXNldEZvcm0iLCJyZXNldCIsImluaXRpYWxDYXJkcyIsInJlcXVpcmUiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImVycm9yVGV4dFNlbGVjdG9yIiwiZWRpdFByb2ZpbGVCdXR0b24iLCJhZGRDYXJkQnV0dG9uIiwiZWRpdFByb2ZpbGVQaWNCdXR0b24iLCJpbnB1dE5hbWUiLCJpbnB1dEpvYiIsImlucHV0UGljdHVyZSIsImFwaSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsIl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInNldFVzZXJJbmZvIiwiZGVzY3JpcHRpb24iLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZVByb2ZpbGVQaWN0dXJlIiwiYXZhdGFyIiwiZ2V0SW5pdGlhbENhcmRMaXN0IiwiYWRkQ2FyZCIsInJlbW92ZUNhcmQiLCJfaWQiLCJ0b2dnbGVMaWtlQ2FyZFN0YXR1cyIsImNhcmRJZCIsImxpa2UiLCJhdXRob3JpemF0aW9uIiwiaW1hZ2VQb3B1cCIsIl9pbWdFbGVtZW50IiwiZGVsZXRlQ29uZmlybVBvcHVwRm9ybSIsImNhcmRMaXN0IiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsInJlbmRlckl0ZW0iLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiY2FyZERhdGEiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ1c2VySW5mbyIsIm5hbWVTZWxlY3RvciIsImRlc2NyaXB0aW9uU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfZGVzY3JpcHRpb25FbGVtZW50IiwiZWRpdFByb2ZpbGVQb3B1cEZvcm0iLCJpbmZvIiwiZmluYWxseSIsImNyZWF0ZUNhcmRQb3B1cEZvcm0iLCJkZWxldGVDYXJkIiwicHJvZmlsZVBpY1BvcHVwRm9ybSIsImVkaXRQcm9maWxlVmFsaWRhdG9yIiwiY3JlYXRlQ2FyZFZhbGlkYXRvciIsInByb2ZpbGVQaWNWYWxpZGF0b3IiXSwic291cmNlUm9vdCI6IiJ9